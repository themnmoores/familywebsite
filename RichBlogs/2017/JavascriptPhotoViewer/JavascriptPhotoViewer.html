<!doctype html>
<html>

<head>
<script src="../../../formatting.js"></script>

<meta name="viewport" content="width=1200">

<meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">ol{margin:0;padding:0}table td,table th{padding:0}.c1{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left;height:11pt}.c3{color:#666666;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c9{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:14pt;font-family:"Arial";font-style:normal}.c0{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:12pt;font-family:"Arial";font-style:normal}.c6{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c4{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:center}.c12{color:#666666;font-weight:400;text-decoration:none;vertical-align:baseline;font-family:"Arial";font-style:normal}.c2{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c11{background-color:#ffffff;max-width:540pt;padding:36pt 36pt 36pt 36pt}.c5{color:inherit;text-decoration:inherit}.c10{color:#1155cc;text-decoration:underline}.c7{height:11pt}.c8{font-size:12pt}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style>

<script>addGoogleAnalytics();</script>

<meta name="description" content="Implementing a simple photo viewer in JavaScript using HTML 5 and JSON">
<meta name="keywords" content="JavaScript, HTML 5, Canvas, Photo Viewer, Photo Gallery, JSON">

</head><body style="padding:0 0 0 0;max-width:100vw" onload="setVerticalPositionToSpan()" class="c11">

<script>setBodyBackgroundFormatting();</script>
<div id="headerTopBar"></div>
<script>commonPageHeaderBarNew2("","../../../");</script>
<script>commonNavivationButtonsNew2("../../../","");</script>

<div style="text-align:center;margin-top:3vw" >

<div style="width:612pt;margin-left: auto;margin-right: auto;">

<p class="c4"><span class="c9">A JavaScript Photo Viewer</span></p><p class="c4"><span class="c9">October 25, 2017</span></p><p class="c4 c7"><span class="c9"></span></p><p class="c2"><span class="c8">It had been over a year since I brought up our website, themnmoores.net, and I had still not implemented the pictures section. Late last spring I did some time looking for a JavaScript framework to implement a photo slideshow/viewer with. This search found a fairly lightweight viewer, Responsive Slides &nbsp;</span><span class="c8 c10"><a class="c5" href="http://responsiveslides.com/">http://responsiveslides.com/</a></span><span class="c0">. I was able to get it running but the lack of documentation made it frustrating and it seemed that I would have to spend a lot of time experimenting to get the very simple functionality I wanted. Past experience using the HTML 5 canvas element for displaying images made me wonder just how hard it would be to implement a simple photo viewer. As it turns out, not very hard at all. This blog entry describes how I implemented a slide viewer in pure Javascript. The resulting viewer is not fancy, it only allows you to go forward and backward through a collection of image files displaying a caption for each image and display a title. </span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c0">The first issue to solve was how to input a list of image files, their captions, and viewer options to the JavaScript code. It seemed that a JSON file would be the logical choice and I started to try and figure out how to read such a file into my JavaScript code. After fussing around with this for a few hours I came up with the idea of putting the JSON I wanted into a global string that can be accessed by the photo viewer code. To do this I create a JavaScript file with only the JSON string in it that could be included by the HTML for the web page. A small sample of such a file is:</span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c3">var photoFileListJSONString;</span></p><p class="c1"><span class="c3"></span></p><p class="c2"><span class="c3">function populatePhotoListJSONString()</span></p><p class="c2"><span class="c3">{</span></p><p class="c2"><span class="c3">&nbsp; photoFileListJSONString = &#39;{&#39;;</span></p><p class="c2"><span class="c3">&nbsp; photoFileListJSONString +=&#39; &quot;displayWindow&quot;: {&quot;width&quot;: 800,&quot;height&quot;: 600,&quot;title&quot;: &quot;Sawtooths 2017&quot;},&#39;;</span></p><p class="c2"><span class="c3">&nbsp; photoFileListJSONString +=&#39; &quot;images&quot;: [&#39;;</span></p><p class="c2"><span class="c3">&nbsp; photoFileListJSONString +=&#39; {&quot;src&quot;: &quot;sawtooths2017.png&quot;,&quot;caption&quot;: &quot;&quot;},&#39;;</span></p><p class="c2"><span class="c3">&nbsp; photoFileListJSONString +=&#39; {&quot;src&quot;: &quot;1.jpg&quot;,&quot;caption&quot;: &quot;Day 1&quot;},&#39;;</span></p><p class="c2"><span class="c3">&nbsp; photoFileListJSONString +=&#39; {&quot;src&quot;: &quot;2.jpg&quot;,&quot;caption&quot;: &quot;Day 1: The view as we approached Stanley&quot;},&#39;;</span></p><p class="c2"><span class="c3">&nbsp; photoFileListJSONString +=&#39; {&quot;src&quot;: &quot;3.jpg&quot;,&quot;caption&quot;: &quot;Day 1: Into the wilderness.&quot;},&#39;;</span></p><p class="c2"><span class="c3">&nbsp; photoFileListJSONString +=&#39; {&quot;src&quot;: &quot;4.jpg&quot;,&quot;caption&quot;: &quot;Day 1: First trail junction&quot;},&#39;;</span></p><p class="c2"><span class="c3">&nbsp; photoFileListJSONString +=&#39; ]}&#39;;</span></p><p class="c2"><span class="c3">}</span></p><p class="c1"><span class="c0"></span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c0">This file is &ldquo;sourced&rdquo; in the HTML before the photo viewer file.</span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c3">&nbsp; &lt;head&gt;</span></p><p class="c2"><span class="c3">&nbsp; &nbsp; &lt;script src=&quot;photofilelist.js&quot;&gt;&lt;/script&gt;</span></p><p class="c2"><span class="c3">&nbsp; &nbsp; &lt;script src=&quot;../../photoslideshow.js&quot;&gt;&lt;/script&gt;</span></p><p class="c1"><span class="c0"></span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c8">The </span><span class="c10 c8"><a class="c5" href="http://themnmoores.net/photoslideshow.js">photoslideshow.js</a></span><span class="c0">&nbsp;file is where the work is done for photo viewing. To initialize things the function initializePhotoSlideShow needs to be called with the ID&rsquo;s of various HTML elements needed for the photo viewer functionality. </span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c3">function initializePhotoSlideShow(canvasID, titleID, captionID, leftArrowID, rightArrowID)<br>{<br> &nbsp;populatePhotoListJSONString();<br> &nbsp;photoSlideShow = JSON.parse(photoFileListJSONString);<br><br> &nbsp;theCanvas = document.getElementById(canvasID);<br> &nbsp;theCanvas.height=Number(photoSlideShow.displayWindow.height);<br> &nbsp;theCanvas.width=Number(photoSlideShow.displayWindow.width);<br> &nbsp;theCanvas.style.borderWidth=&quot;3px&quot;;<br> &nbsp;theCanvas.style.borderStyle = &quot;solid&quot;;<br> &nbsp;theCanvas.style.borderColor=&quot;#000000&quot;;<br><br> &nbsp;caption = document.getElementById(captionID);<br> &nbsp;caption.style.width = theCanvas.width.toString() + &quot;px&quot;;<br> &nbsp;leftArrow = &nbsp;document.getElementById(leftArrowID);<br> &nbsp;rightArrow = &nbsp;document.getElementById(rightArrowID);<br> &nbsp;<br> &nbsp;theTitle = document.getElementById(titleID);<br> &nbsp;theTitle.innerHTML = &#39;&lt;b&gt;&#39; + photoSlideShow.displayWindow.title + &#39;&lt;/b&gt;&#39;;<br> &nbsp;<br> &nbsp;currentImageNumberInSlideShow = 0;</span></p><p class="c2"><span class="c3">&nbsp;setCurrentImage(photoSlideShow.images[currentImageNumberInSlideShow].src,photoSlideShow.images[currentImageNumberInSlideShow].caption);<br>}<br></span></p><p class="c1"><span class="c6"></span></p><p class="c2"><span class="c0">First the JSON string for the photo list and viewer configuration is created by calling the populatePhotoListJSONString function provided by the photo list JavaScript file. Then the JSON information is parsed into the global variable photoSlideShow. The HTML 5 canvas element is then configured based on the slide show information just parsed as is the title string. Some setup of the caption text area, left arrow and right arrow elements is done. Here is some sample HTML for this.</span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c3">&nbsp; &nbsp;&lt;!-- Create simple photo viewer --&gt;<br> &nbsp; &nbsp;&lt;div style=&quot;text-align:center;&quot;&gt;<br> &nbsp; &nbsp; &nbsp;&lt;div style=&quot;margin-left:auto;margin-right:auto;margin-top:40px&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;p id=&quot;themnmooresTitle&quot; style=&quot;font-family:Arial, serif;font-size: 20px;margin-left:auto;margin-right:auto;text-align: center;margin-bottom:0&quot;&gt;title&lt;/p&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;img id=&quot;themnmooresLeft&quot; height=&quot;80px&quot; src=&quot;../../pictures/leftArrow512.png&quot; style=&quot;margin-bottom:260px&quot; onclick=&quot;leftArrowPressed()&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;canvas id=&quot;themnmooresPhotoCanvas&quot; &gt;&lt;/canvas&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;img id=&quot;themnmooresRight&quot; height=&quot;80px&quot; src=&quot;../../pictures/rightArrow512.png&quot; style=&quot;margin-bottom:260px&quot; onclick=&quot;rightArrowPressed()&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;p id=&quot;themnmooresCaption&quot; style=&quot;;margin-top:10px;font-family:Arial, serif;font-size: 18px;margin-left:auto;margin-right:auto;text-align: left;&quot;&gt;&lt;/p&gt; &nbsp; &nbsp; <br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;script&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;initializePhotoSlideShow(&quot;themnmooresPhotoCanvas&quot;, &quot;themnmooresTitle&quot;, &quot;themnmooresCaption&quot;, &quot;themnmooresLeft&quot;, &quot;themnmooresRight&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;/script&gt; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp;&lt;/div&gt; &nbsp; &nbsp;<br> &nbsp; &nbsp;&lt;/div&gt;<br></span></p><p class="c1"><span class="c3"></span></p><p class="c2"><span class="c0">As you can see the HTML required is very minimal. Finally the current image number is set to 0 and the setCurrentImage function is called to start the display process for that image. </span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c3">function setCurrentImage(imageFileName, captionText)<br>{<br> &nbsp;caption.innerHTML = captionText;<br> &nbsp;currentImage = new Image();<br> &nbsp;currentImage.onload = displayCurrentImage;<br> &nbsp;currentImage.src = imageFileName;<br>}<br></span></p><p class="c1"><span class="c6"></span></p><p class="c2"><span class="c0">The setCurrentImage function simply creates a new Image object, sets the image file name to be read, and the onload callback is set to be the displayCurrentImage function. It then returns to allow the asynchronous process of loading image file data to start. </span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c0">The displayCurrentImage function does the work of rendering the image data to the canvas element and updating the caption text.</span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c3">function displayCurrentImage()<br>{<br> &nbsp;ctx = theCanvas.getContext(&quot;2d&quot;);<br> &nbsp;ctx.clearRect(0, 0, theCanvas.width, theCanvas.height);<br> &nbsp;// Figure out how to display<br> &nbsp;var x = 0;<br> &nbsp;var y = 0;<br> &nbsp;var width = ctx.canvas.width;<br> &nbsp;var height = ctx.canvas.height;<br> &nbsp;<br> &nbsp;// Figure out how to fit the image to the slide show<br> &nbsp;scaleFactorX = width / currentImage.width;<br> &nbsp;scaleFactorY = height / currentImage.height;<br> &nbsp;if (scaleFactorX &lt; scaleFactorY) &nbsp; &nbsp; &nbsp;// Means the x dimension gets scaled more<br> &nbsp;{<br> &nbsp; &nbsp;y = (height - (currentImage.height * scaleFactorX)) / 2.0; // So we center the image vertically<br> &nbsp; &nbsp;height = currentImage.height * scaleFactorX;<br> &nbsp;}<br> &nbsp;else &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Means the y dimension gets scaled more<br> &nbsp;{<br> &nbsp; &nbsp;x = (width - (currentImage.width * scaleFactorY)) / 2.0; // So we center the image horizontally<br> &nbsp; &nbsp;width = currentImage.width * scaleFactorY;<br> &nbsp; &nbsp;<br> &nbsp;}<br> &nbsp;<br> &nbsp;ctx.drawImage(currentImage, x, y, width, height);<br> &nbsp;<br>}<br></span></p><p class="c1"><span class="c6"></span></p><p class="c2"><span class="c0">We get a drawing context for the canvas element and clear the canvas so we can render the new image data. Based on the canvas size and image data dimensions the rending size of the image data in the canvas is determined as to properly keep the image data aspect ratio. The image data is also properly centered horizontally and vertically based on the scaling factor. That is all that is needed for rendering an image file. </span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c0">If the left arrow element is pressed, the leftArrowPressed function is called.</span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c3">function leftArrowPressed()<br>{<br> &nbsp;if (currentImageNumberInSlideShow === 0)<br> &nbsp;{<br> &nbsp; &nbsp;currentImageNumberInSlideShow = photoSlideShow.images.length-1;<br> &nbsp;}<br> &nbsp;else<br> &nbsp;{<br> &nbsp; &nbsp;currentImageNumberInSlideShow--;<br> &nbsp;}<br> &nbsp;<br> &nbsp;rightArrow.style.visibility = &quot;visible&quot;;<br> &nbsp;setCurrentImage(photoSlideShow.images[currentImageNumberInSlideShow].src,photoSlideShow.images[currentImageNumberInSlideShow].caption);<br> &nbsp;displayCurrentImage();<br>}</span></p><p class="c1"><span class="c8 c12"></span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c0">I decided to implement a wrap around viewer that goes from the first photo to the last photo when the left arrow is pressed so the current image number is modified to reflect the proper position in the photo list and the setCurrentImage function is called.</span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c0">If the right arrow element is pressed, the rightArrowPressed function is called.</span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c3">function rightArrowPressed()<br>{<br> &nbsp;if (currentImageNumberInSlideShow == photoSlideShow.images.length-1)<br> &nbsp;{<br> &nbsp; &nbsp;currentImageNumberInSlideShow = 0;<br> &nbsp;}<br> &nbsp;else<br> &nbsp;{<br> &nbsp; &nbsp;currentImageNumberInSlideShow++;<br> &nbsp;}<br> &nbsp;<br> &nbsp;leftArrow.style.visibility = &quot;visible&quot;;<br> &nbsp;setCurrentImage(photoSlideShow.images[currentImageNumberInSlideShow].src,photoSlideShow.images[currentImageNumberInSlideShow].caption);<br> &nbsp;displayCurrentImage();<br>}<br></span></p><p class="c2"><span class="c0"><br>As with the left arrow the right arrow wraps from the last image to the first image so we set up the proper index in the photo list and call the setCurrentImage function.</span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c8">As you can see, it turned out to be fairly easy to implement a very basic photo viewer in stock JavaScript. In the future I might consider some performance enhancements to pre fetch and cache image data to make the viewing experience faster. One thing that is bothersome to be is that the JavaScript does not seem to be release the Image object memory as the memory usage of the web page continues to increase. I put about 16 hours of work into implementing this, including a utility to resize image files, see </span><span class="c10 c8"><a class="c5" href="http://themnmoores.net/ResizePhotoZip/resizePhotoZip.html">resizePhotoZip</a></span><span class="c0">. I will write up a blog entry about that code next.</span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c8">Here is the first photo album, </span><span class="c10 c8"><a class="c5" href="http://themnmoores.net/Photos/Sawtooths2017/Sawtooths2017.html">Sawtooths2017</a></span></p><p class="c1"><span class="c0"></span></p><p class="c1"><span class="c0"></span></p><p class="c4"><span class="c6">Copyright 2017, Richard J. Moore</span></p><p class="c1"><span class="c6"></span></p><p class="c2"><span class="c6">keywords: JavaScript, HTML 5, Canvas, Photo Viewer, Photo Gallery, JSON</span></p><p class="c2"><span class="c6">description: Implementing a simple photo viewer in JavaScript using HTML 5 and JSON</span></p><p class="c1"><span class="c0"></span></p>

<script>addHTMLCommentBox();</script>

</body></html>